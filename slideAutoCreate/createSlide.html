<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è³‡æ–™è‡ªå‹•ä½œæˆã‚¢ãƒ—ãƒª UIãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap');
    
    :root {
      --primary-color: #00A9E0;
      --secondary-color: #00B2A9;
      --accent-color: #DA1884;
      --background-color: #F8FAFB;
      --card-background: #FFFFFF;
      --border-color: #E8ECEF;
      --text-primary: #1A1F36;
      --text-secondary: #5A6376;
      --shadow-sm: 0 2px 4px rgba(0,0,0,0.04);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
      --transition-base: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --sidebar-width: 260px;
    }
    
    * {
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--background-color);
      font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-primary);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
    @keyframes slideIn {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes slideDown {
      from { max-height: 0; opacity: 0; }
      to { max-height: 600px; opacity: 1; }
    }
    
    /* ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠ */
    .app-root {
      display: flex;
      height: 100vh;
      position: relative;
      background: var(--background-color);
    }
    
    /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: var(--transition-base);
      z-index: 40;
    }
    
    .overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--card-background);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 50;
      transform: translateX(-100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--shadow-lg);
    }
    
    .sidebar.active {
      transform: translateX(0);
    }
    
    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .sidebar-logo {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .sidebar-close {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: var(--transition-base);
    }
    
    .sidebar-close:hover {
      background: var(--background-color);
    }
    
    .nav {
      flex: 1;
      padding: 16px 0;
      overflow-y: auto;
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition-base);
      position: relative;
      text-decoration: none;
    }
    
    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--primary-color);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .nav-item:hover {
      color: var(--primary-color);
      background: rgba(0, 169, 224, 0.05);
    }
    
    .nav-item.active {
      color: var(--primary-color);
      background: rgba(0, 169, 224, 0.08);
      font-weight: 600;
    }
    
    .nav-item.active::before {
      transform: scaleX(1);
    }
    
    .nav-icon {
      font-size: 20px;
    }
    
    .user-info {
      padding: 24px;
      border-top: 1px solid var(--border-color);
      background: var(--background-color);
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    .user-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    
    .user-email {
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--background-color);
      position: relative;
      width: 100%;
    }
    
    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
      background: var(--card-background);
      border-bottom: 1px solid var(--border-color);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 30;
      box-shadow: var(--shadow-sm);
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .menu-toggle {
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: var(--transition-base);
    }
    
    .menu-toggle:hover {
      background: var(--background-color);
    }
    
    .menu-toggle svg {
      width: 24px;
      height: 24px;
    }
    
    .header-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      /*width: 120px;
      height: 40px;*/
      overflow: hidden;
    }
    
    .header-logo img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    
    .header-actions {
      display: flex;
      gap: 12px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      outline: none;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      box-shadow: 0 4px 12px rgba(0, 169, 224, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 169, 224, 0.4);
    }
    
    .btn-secondary {
      background: var(--background-color);
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }
    
    .btn-secondary:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }
    
    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ */
    .status-bar-container {
      position: relative;
      background: var(--card-background);
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      overflow-x: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .status-bar {
      display: flex;
      align-items: center;
      gap: 0;
      flex: 1;
      margin: 0 auto;
      max-width: 1000px;
    }
    
    .status-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      position: relative;
      cursor: pointer;
      transition: var(--transition-base);
    }
    
    .status-step:hover {
      transform: translateY(-2px);
    }
    
    .status-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--background-color);
      border: 3px solid var(--border-color);
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
      transition: var(--transition-base);
      position: relative;
    }
    
    .status-step.active .status-circle {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
      animation: pulse 2s infinite;
    }
    
    .status-step.completed .status-circle {
      background: var(--secondary-color);
      border-color: var(--secondary-color);
      color: white;
    }
    
    .status-step.completed .status-circle::after {
      content: 'âœ“';
      position: absolute;
      font-size: 20px;
    }
    
    .status-label {
      margin-top: 8px;
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
      transition: var(--transition-base);
    }
    
    .status-step.active .status-label,
    .status-step.completed .status-label {
      color: var(--text-primary);
      font-weight: 600;
    }
    
    .status-line {
      flex: 1;
      height: 3px;
      background: var(--border-color);
      margin: 0 -20px;
      z-index: 1;
      transition: var(--transition-base);
    }
    
    .status-step.completed + .status-line {
      background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
    }
    
    /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
    .main-area {
      flex: 1;
      display: flex;
      gap: 0;
      padding: 24px;
      overflow: hidden;
      position: relative;
      min-width: 0;
      overflow-x: hidden;
      width: 100%;
      box-sizing: border-box;
    }
    
    /* ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« */
    .chat-panel {
      background: var(--card-background);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid var(--border-color);
      transition: flex 0.4s cubic-bezier(0.4, 0, 0.2, 1), width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      animation: slideIn 0.4s ease-out;
      flex: 0 0 420px;
      min-width: 240px;
      max-width: 80vw;
      box-sizing: border-box;
      flex-basis: 50%;
      flex-shrink: 1;
      flex-grow: 1;
    }
    
    .chat-panel.expanded {
      flex: 1 1 100%;
      max-width: 100%;
    }
    
    .chat-header {
      padding: 20px 24px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      font-weight: 600;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .chat-header-actions {
      display: flex;
      gap: 8px;
    }
    
    .chat-header-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-base);
    }
    
    .chat-header-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      background: var(--background-color);
      scroll-behavior: smooth;
    }
    
    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }
    
    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .chat-messages::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 3px;
    }
    
    .chat-message {
      margin-bottom: 16px;
      animation: fadeIn 0.3s ease-out;
    }
    
    .chat-message.user {
      display: flex;
      justify-content: flex-end;
    }
    
    .chat-message.ai {
      display: flex;
      justify-content: flex-start;
    }
    
    .message-bubble {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.6;
      position: relative;
      box-shadow: var(--shadow-sm);
    }
    
    .chat-message.user .message-bubble {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border-bottom-right-radius: 4px;
    }
    
    .chat-message.ai .message-bubble {
      background: white;
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-bottom-left-radius: 4px;
    }
    
    .message-time {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 4px;
      text-align: right;
    }
    
    /* é¸æŠUI */
    .selection-container {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      margin: 8px 0;
      box-shadow: var(--shadow-sm);
      animation: slideDown 0.3s ease-out;
    }
    
    .selection-label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
    }
    
    .selection-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .selection-option {
      padding: 8px 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background: white;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-base);
    }
    
    .selection-option:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      transform: translateY(-1px);
    }
    
    .selection-option.selected {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }
    
    .file-upload-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .file-upload-input {
      display: none;
    }
    
    .file-upload-label {
      padding: 12px;
      border: 2px dashed var(--border-color);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-base);
      background: var(--background-color);
    }
    
    .file-upload-label:hover {
      border-color: var(--primary-color);
      background: rgba(0, 169, 224, 0.05);
    }
    
    .file-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background: var(--background-color);
      border-radius: 8px;
      font-size: 13px;
    }
    
    .file-remove {
      color: var(--accent-color);
      cursor: pointer;
      font-weight: 600;
    }
    
    /* ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ */
    .chat-input-container {
      padding: 16px;
      background: white;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }
    
    .chat-input-wrapper {
      flex: 1;
      position: relative;
    }
    
    .chat-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      font-size: 14px;
      resize: none;
      outline: none;
      transition: var(--transition-base);
      font-family: inherit;
      max-height: 120px;
      overflow-y: auto;
    }
    
    .chat-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(0, 169, 224, 0.1);
    }
    
    .chat-input:disabled {
      background: var(--background-color);
      color: var(--text-secondary);
    }
    
    .input-actions {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
      font-size: 18px;
    }
    
    .action-btn.send {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      box-shadow: 0 4px 12px rgba(0, 169, 224, 0.3);
    }
    
    .action-btn.send:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 169, 224, 0.4);
    }
    
    .action-btn.generate {
      background: linear-gradient(135deg, var(--accent-color), #E85D75);
      color: white;
      box-shadow: 0 4px 12px rgba(218, 24, 132, 0.3);
    }
    
    .action-btn.generate:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(218, 24, 132, 0.4);
    }
    
    .action-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
    .resize-bar {
      width: 8px;
      cursor: ew-resize;
      background: linear-gradient(180deg, #e8ecef 60%, #c7d7e0 100%);
      transition: background 0.2s;
      z-index: 10;
      position: relative;
      border-radius: 4px;
      margin: 0 4px;
      flex-shrink: 0;
      display: none;
    }
    .resize-bar.active,
    .preview-container:not(.hidden) ~ .resize-bar,
    .resize-bar.visible {
      display: block;
    }
    .resize-bar:hover,
    .resize-bar.dragging {
      background: linear-gradient(180deg, #00A9E0 0%, #00B2A9 100%);
    }
    
    /* ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« */
    .chat-panel {
      background: var(--card-background);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid var(--border-color);
      transition: flex 0.4s cubic-bezier(0.4, 0, 0.2, 1), width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      animation: slideIn 0.4s ease-out;
      flex: 0 0 420px;
      min-width: 240px;
      max-width: 80vw;
      box-sizing: border-box;
      flex-basis: 50%;
      flex-shrink: 1;
      flex-grow: 1;
    }
    
    .chat-panel.expanded {
      flex: 1 1 100%;
      max-width: 100%;
    }
    
    .chat-header {
      padding: 20px 24px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      font-weight: 600;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .chat-header-actions {
      display: flex;
      gap: 8px;
    }
    
    .chat-header-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-base);
    }
    
    .chat-header-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      background: var(--background-color);
      scroll-behavior: smooth;
    }
    
    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }
    
    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .chat-messages::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 3px;
    }
    
    .chat-message {
      margin-bottom: 16px;
      animation: fadeIn 0.3s ease-out;
    }
    
    .chat-message.user {
      display: flex;
      justify-content: flex-end;
    }
    
    .chat-message.ai {
      display: flex;
      justify-content: flex-start;
    }
    
    .message-bubble {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.6;
      position: relative;
      box-shadow: var(--shadow-sm);
    }
    
    .chat-message.user .message-bubble {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border-bottom-right-radius: 4px;
    }
    
    .chat-message.ai .message-bubble {
      background: white;
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-bottom-left-radius: 4px;
    }
    
    .message-time {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 4px;
      text-align: right;
    }
    
    /* é¸æŠUI */
    .selection-container {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      margin: 8px 0;
      box-shadow: var(--shadow-sm);
      animation: slideDown 0.3s ease-out;
    }
    
    .selection-label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
    }
    
    .selection-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .selection-option {
      padding: 8px 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background: white;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-base);
    }
    
    .selection-option:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      transform: translateY(-1px);
    }
    
    .selection-option.selected {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }
    
    .file-upload-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .file-upload-input {
      display: none;
    }
    
    .file-upload-label {
      padding: 12px;
      border: 2px dashed var(--border-color);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition-base);
      background: var(--background-color);
    }
    
    .file-upload-label:hover {
      border-color: var(--primary-color);
      background: rgba(0, 169, 224, 0.05);
    }
    
    .file-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background: var(--background-color);
      border-radius: 8px;
      font-size: 13px;
    }
    
    .file-remove {
      color: var(--accent-color);
      cursor: pointer;
      font-weight: 600;
    }
    
    /* ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ */
    .chat-input-container {
      padding: 16px;
      background: white;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }
    
    .chat-input-wrapper {
      flex: 1;
      position: relative;
    }
    
    .chat-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      font-size: 14px;
      resize: none;
      outline: none;
      transition: var(--transition-base);
      font-family: inherit;
      max-height: 120px;
      overflow-y: auto;
    }
    
    .chat-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(0, 169, 224, 0.1);
    }
    
    .chat-input:disabled {
      background: var(--background-color);
      color: var(--text-secondary);
    }
    
    .input-actions {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-base);
      font-size: 18px;
    }
    
    .action-btn.send {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      box-shadow: 0 4px 12px rgba(0, 169, 224, 0.3);
    }
    
    .action-btn.send:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 169, 224, 0.4);
    }
    
    .action-btn.generate {
      background: linear-gradient(135deg, var(--accent-color), #E85D75);
      color: white;
      box-shadow: 0 4px 12px rgba(218, 24, 132, 0.3);
    }
    
    .action-btn.generate:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(218, 24, 132, 0.4);
    }
    
    .action-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
    .resize-bar {
      width: 8px;
      cursor: ew-resize;
      background: linear-gradient(180deg, #e8ecef 60%, #c7d7e0 100%);
      transition: background 0.2s;
      z-index: 10;
      position: relative;
      border-radius: 4px;
      margin: 0 4px;
      flex-shrink: 0;
      display: none;
    }
    .resize-bar.active,
    .preview-container:not(.hidden) ~ .resize-bar,
    .resize-bar.visible {
      display: block;
    }
    .resize-bar:hover,
    .resize-bar.dragging {
      background: linear-gradient(180deg, #00A9E0 0%, #00B2A9 100%);
    }
    
    /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
    .main-area {
      flex: 1;
      display: flex;
      gap: 0;
      padding: 24px;
      overflow: hidden;
      position: relative;
      min-width: 0;
      overflow-x: hidden;
      width: 100%;
      box-sizing: border-box;
    }
    
    /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ */
    .preview-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      min-width: 0;
      transition: opacity 0.3s ease-out;
      /* è¿½åŠ : æœ€å°å¹…ã‚’è¨­å®š */
      min-width: 320px;
      max-width: 80vw;
      box-sizing: border-box;
      flex-basis: 50%;
      flex-shrink: 1;
      flex-grow: 1;
    }
    
    .preview-container.hidden {
      display: none;
    }
    
    .preview-panel {
      width: 100%;
      height: 100%;
      background: var(--card-background);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      animation: fadeIn 0.4s ease-out;
    }
    
    .preview-header {
      background: white;
      border-bottom: 1px solid var(--border-color);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: flex-end; /* å³å¯„ã›ã«å¤‰æ›´ */
      gap: 16px; /* ã‚¿ãƒ–ã¨ãƒœã‚¿ãƒ³ã®é–“ã«ä½™ç™½ã‚’è¿½åŠ  */
    }
    
    .preview-tabs {
      display: flex;
      gap: 4px;
      margin-right: auto; /* ã‚¿ãƒ–ã‚’å·¦å¯„ã›ã€ãƒœã‚¿ãƒ³ã‚’å³å¯„ã›ã« */
    }
    
    .preview-actions {
      display: flex;
      gap: 8px;
    }
    
    .preview-action-btn, .download-dropdown-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* ãƒ¢ãƒ€ãƒ³ãªé…è‰² */
      color: white;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-base);
      box-shadow: 0 2px 8px rgba(0,169,224,0.10);
    }
    
    .preview-action-btn:hover, .download-dropdown-btn:hover, .download-dropdown-btn.active {
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
      color: #fff;
      box-shadow: 0 4px 16px rgba(0,169,224,0.18);
    }
    
    .download-dropdown {
      position: relative;
      display: inline-block;
    }
    .download-dropdown-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--background-color);
      color: var(--text-secondary);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-base);
    }
    .download-dropdown-btn:hover,
    .download-dropdown-btn.active {
      background: var(--border-color);
      color: var(--text-primary);
    }
    .download-dropdown-list {
      display: none;
      position: absolute;
      right: 0;
      top: 110%;
      min-width: 140px;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      z-index: 100;
      padding: 4px 0;
    }
    .download-dropdown.open .download-dropdown-list {
      display: block;
    }
    .download-dropdown-item {
      width: 100%;
      padding: 10px 16px;
      background: none;
      border: none;
      text-align: left;
      color: var(--text-primary);
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .download-dropdown-item:hover {
      background: var(--background-color);
    }
    
    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼å³ç«¯ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³é…ç½® */
    .status-bar-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .status-bar {
      flex: 1;
    }
    .preview-toggle {
      position: static;
      right: unset;
      bottom: unset;
      margin-left: 16px;
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 16px rgba(0, 169, 224, 0.4);
      transition: var(--transition-base);
      z-index: 2;
    }
    .preview-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 32px rgba(0, 169, 224, 0.5);
    }
    .preview-toggle.hidden {
      display: none;
    }
    
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 1024px) {
      .chat-panel {
        flex: 0 0 360px;
      }
    }
    
    @media (max-width: 768px) {
      .main-area {
        flex-direction: column;
        padding: 16px;
      }
      
      .chat-panel,
      .chat-panel.expanded {
        flex: 0 0 auto;
        width: 100%;
        max-width: 100%;
      }
      
      .preview-container {
        height: 400px;
      }
      
      .status-bar-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
    }
  </style>
</head>
<body>
  <div class="app-root">
    <!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="overlay" id="overlay"></div>
    
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">SlideGenius</div>
        <button class="sidebar-close" onclick="toggleSidebar()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="nav">
        <a class="nav-item" href="index.html">
          <span class="nav-icon">ğŸ </span>
          <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </a>
        <a class="nav-item" href="createSlide.html">
          <span class="nav-icon">â•</span>
          <span>æ–°è¦ä½œæˆ</span>
        </a>
        <a class="nav-item" href="template.html">
          <span class="nav-icon">ğŸ“‹</span>
          <span>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†</span>
        </a>
        <a class="nav-item" href="#">
          <span class="nav-icon">ğŸ•‘</span>
          <span>å±¥æ­´ç®¡ç†</span>
        </a>
        <a class="nav-item" href="#">
          <span class="nav-icon">âš™ï¸</span>
          <span>è¨­å®š</span>
        </a>
      </div>
      <div class="user-info">
        <div class="user-avatar">å±±</div>
        <div class="user-name">å±±ç”° å¤ªéƒ</div>
        <div class="user-email">yamada@example.com</div>
      </div>
    </nav>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="main-content">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" onclick="toggleSidebar()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M3 12h18M3 6h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <div class="header-logo">
            <img src="logo_slideapp.svg" alt="SlideGenius">
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary">
            <span>ğŸ“š</span>
            <span>ä½¿ã„æ–¹</span>
          </button>
          <button class="btn btn-primary" onclick="startNewCreation()">
            <span>â•</span>
            <span>æ–°è¦ä½œæˆ</span>
          </button>
        </div>
      </header>
      
      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
      <div class="status-bar-container">
        <div class="status-bar" id="statusBar">
          <div class="status-step" data-step="1">
            <div class="status-circle">1</div>
            <div class="status-label">ãƒ¢ãƒ¼ãƒ‰é¸æŠ</div>
          </div>
          <div class="status-line"></div>
          <div class="status-step" data-step="2">
            <div class="status-circle">2</div>
            <div class="status-label">å…¥åŠ›æ–¹æ³•</div>
          </div>
          <div class="status-line"></div>
          <div class="status-step" data-step="3">
            <div class="status-circle">3</div>
            <div class="status-label">AIãƒãƒ£ãƒƒãƒˆ</div>
          </div>
          <div class="status-line"></div>
          <div class="status-step" data-step="4">
            <div class="status-circle">4</div>
            <div class="status-label">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
          </div>
          <div class="status-line"></div>
          <div class="status-step" data-step="5">
            <div class="status-circle">5</div>
            <div class="status-label">å®Œäº†</div>
          </div>
        </div>
        <button class="preview-toggle" id="previewToggle" onclick="showPreview()" title="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>
      
      <!-- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ -->
      <div class="main-area" id="mainArea">
        <!-- ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« -->
        <div class="chat-panel expanded" id="chatPanel">
          <div class="chat-header">
            <span>AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</span>
            <div class="chat-header-actions">
              <button class="chat-header-btn" title="å±¥æ­´ã‚’ã‚¯ãƒªã‚¢">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v11a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
          </div>
          
          <div class="chat-messages" id="chatMessages">
            <!-- åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <div class="chat-message ai">
              <div class="message-bubble">
                ã“ã‚“ã«ã¡ã¯ï¼è³‡æ–™ä½œæˆã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚
                ã©ã®ã‚ˆã†ãªè³‡æ–™ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ
              </div>
              <div class="message-time">10:00</div>
            </div>
          </div>
          
          <div class="chat-input-container">
            <div class="chat-input-wrapper">
              <textarea 
                class="chat-input" 
                id="chatInput"
                placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
                rows="1"
                disabled
              ></textarea>
            </div>
            <div class="input-actions">
              <button class="action-btn send" id="sendBtn" disabled title="é€ä¿¡">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="action-btn generate" id="generateBtn" style="display: none;" title="ç”Ÿæˆ">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        
        <!-- ãƒªã‚µã‚¤ã‚ºãƒãƒ¼è¿½åŠ  -->
        <div class="resize-bar" id="resizeBar"></div>
        
        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div class="preview-container hidden" id="previewContainer">
          <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‘ãƒãƒ« -->
          <div class="preview-panel" id="previewPanel">
            <div class="preview-header">
              <div class="preview-tabs">
                <button class="preview-tab active" onclick="switchPreviewTab('preview')">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                <button class="preview-tab" onclick="switchPreviewTab('code')">HTMLã‚³ãƒ¼ãƒ‰</button>
              </div>
              <div class="preview-actions">
                <div class="version-selector">
                  <label>ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</label>
                  <select id="versionSelect">
                    <option value="v1">v1 (æœ€æ–°)</option>
                  </select>
                </div>
                <!-- â–¼ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«å¤‰æ›´ -->
                <div class="download-dropdown" id="downloadDropdown">
                  <button class="download-dropdown-btn" id="downloadDropdownBtn" title="ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <svg width="12" height="12" style="margin-left:2px;" viewBox="0 0 12 12" fill="none">
                      <path d="M3 5l3 3 3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </button>
                  <div class="download-dropdown-list" id="downloadDropdownList">
                    <button class="download-dropdown-item" onclick="downloadHTMLCodeCopy()">HTML_CodeCopy</button>
                    <button class="download-dropdown-item" onclick="downloadPDF()">PDF</button>
                    <button class="download-dropdown-item" onclick="downloadSVG()">SVG</button>
                  </div>
                </div>
                <!-- â–² -->
                <button class="preview-action-btn" onclick="hidePreview()" title="é–‰ã˜ã‚‹">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="preview-content" style="position:relative;">
              <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ–å†…ã«åˆæœŸãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹divã‚’è¿½åŠ  -->
              <div id="previewPlaceholder" style="display:block; color:#888; text-align:center; font-size:16px; padding:40px 0;">
                ç”Ÿæˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã“ã“ã«è³‡æ–™ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
              </div>
              <iframe class="preview-iframe" id="previewFrame" style="display:none;"></iframe>
              <div class="code-view" id="codeView" style="display: none;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ç®¡ç†
    const appState = {
      currentStep: 1,
      mode: null,
      subMode: null,
      inputMethod: null,
      selectedTemplate: null,
      uploadedFiles: [],
      messages: [],
      versions: [],
      currentVersion: 0,
      isPreviewVisible: false,
      currentTab: 'preview',
      diagramType: null
    };
    
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
    const templates = {
      slide_single: [
        { id: 'exec-summary', name: 'ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–å‘ã‘è¦ç´„', icon: 'ğŸ‘”' },
        { id: 'meeting-minutes', name: 'ä¼šè­°è­°äº‹éŒ²', icon: 'ğŸ“' },
        { id: 'progress-report', name: 'é€²æ—ãƒ»æˆæœå ±å‘Š', icon: 'ğŸ“Š' },
        { id: 'infographic', name: 'ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯', icon: 'ğŸ¨' },
        { id: 'news-flash', name: 'é€Ÿå ±è³‡æ–™', icon: 'âš¡' },
        { id: 'kpi-dashboard', name: 'KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', icon: 'ğŸ“ˆ' }
      ],
      slide_multi: [
        { id: 'proposal', name: 'ä¼ç”»ãƒ»ææ¡ˆæ›¸', icon: 'ğŸ’¡' },
        { id: 'project-report', name: 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå ±å‘Šæ›¸', icon: 'ğŸ“‹' },
        { id: 'training', name: 'ç ”ä¿®ãƒ»æ•™è‚²è³‡æ–™', icon: 'ğŸ“' },
        { id: 'product-intro', name: 'è£½å“ç´¹ä»‹', icon: 'ğŸ“¦' },
        { id: 'presentation', name: 'ä¼šè­°ç”¨ãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™', icon: 'ğŸ–¥ï¸' },
        { id: 'design-review', name: 'è£…ç½®è¨­è¨ˆDRè³‡æ–™', icon: 'âš™ï¸' },
        { id: 'experiment-report', name: 'å®Ÿé¨“å ±å‘Šè³‡æ–™', icon: 'ğŸ”¬' }
      ],
      report: [
        { id: 'industry-analysis', name: 'æ¥­ç•Œåˆ†æ', icon: 'ğŸ¢' },
        { id: 'market-research', name: 'å¸‚å ´èª¿æŸ»', icon: 'ğŸ”' },
        { id: 'tech-trends', name: 'æŠ€è¡“ãƒˆãƒ¬ãƒ³ãƒ‰è§£èª¬', icon: 'ğŸ’»' },
        { id: 'product-comparison', name: 'è£½å“æ¯”è¼ƒ', icon: 'âš–ï¸' },
        { id: 'improvement', name: 'æ¥­å‹™æ”¹å–„', icon: 'ğŸ“ˆ' },
        { id: 'data-analysis', name: 'ãƒ‡ãƒ¼ã‚¿åˆ†æ', icon: 'ğŸ“Š' },
        { id: 'regular-report', name: 'å®šæœŸãƒ¬ãƒãƒ¼ãƒˆ', icon: 'ğŸ“…' },
        { id: 'experiment-result', name: 'å®Ÿé¨“ãƒ¬ãƒãƒ¼ãƒˆ', icon: 'ğŸ§ª' }
      ]
    };
    
    // ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆ¶å¾¡
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    }
    
    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹
    document.getElementById('overlay').addEventListener('click', () => {
      toggleSidebar();
    });
    
    // æ–°è¦ä½œæˆé–‹å§‹
    function startNewCreation() {
      // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      
      // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
      appState.currentStep = 1;
      appState.mode = null;
      appState.subMode = null;
      appState.inputMethod = null;
      appState.selectedTemplate = null;
      appState.diagramType = null;
      
      // UIã‚’ãƒªã‚»ãƒƒãƒˆ
      updateStatusBar(1);
      clearChat();
      hidePreview();
      
      // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ¢ãƒ¼ãƒ‰é¸æŠã‚’è¡¨ç¤º
      addMessage('ai', 'ã©ã®ãƒ¢ãƒ¼ãƒ‰ã§è³‡æ–™ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ');
      showModeSelection();
    }
    
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼æ›´æ–°
    function updateStatusBar(step) {
      const steps = document.querySelectorAll('.status-step');
      steps.forEach((stepEl, index) => {
        if (index + 1 < step) {
          stepEl.classList.add('completed');
          stepEl.classList.remove('active');
        } else if (index + 1 === step) {
          stepEl.classList.add('active');
          stepEl.classList.remove('completed');
        } else {
          stepEl.classList.remove('active', 'completed');
        }
      });
      appState.currentStep = step;
    }
    
    // ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
    function addMessage(type, content, isSelection = false) {
      const messagesEl = document.getElementById('chatMessages');
      const messageEl = document.createElement('div');
      messageEl.className = `chat-message ${type}`;
      
      if (isSelection) {
        messageEl.innerHTML = content;
      } else {
        const time = new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        messageEl.innerHTML = `
          <div class="message-bubble">${content}</div>
          <div class="message-time">${time}</div>
        `;
      }
      
      messagesEl.appendChild(messageEl);
      messagesEl.scrollTop = messagesEl.scrollHeight;
      
      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çŠ¶æ…‹ã«ä¿å­˜
      appState.messages.push({ type, content });
    }
    
    // ãƒãƒ£ãƒƒãƒˆã‚¯ãƒªã‚¢
    function clearChat() {
      const messagesEl = document.getElementById('chatMessages');
      messagesEl.innerHTML = `
        <div class="chat-message ai">
          <div class="message-bubble">
            ã“ã‚“ã«ã¡ã¯ï¼è³‡æ–™ä½œæˆã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚
            ã©ã®ã‚ˆã†ãªè³‡æ–™ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ
          </div>
          <div class="message-time">${new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}</div>
        </div>
      `;
      appState.messages = [];
    }
    
    // ãƒ¢ãƒ¼ãƒ‰é¸æŠè¡¨ç¤º
    function showModeSelection() {
      const selectionHTML = `
        <div class="selection-container">
          <label class="selection-label">ä½œæˆãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ</label>
          <div class="selection-options">
            <button class="selection-option" onclick="selectMode('slide')">ğŸ“Š ã‚¹ãƒ©ã‚¤ãƒ‰</button>
            <button class="selection-option" onclick="selectMode('report')">ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆ</button>
            <button class="selection-option" onclick="selectMode('diagram')">ğŸ“ˆ å›³è§£ç”Ÿæˆ</button>
            <button class="selection-option" onclick="selectMode('draft')">âœï¸ åŸç¨¿ä½œæˆ</button>
          </div>
        </div>
      `;
      addMessage('ai', selectionHTML, true);
    }
    
    // ãƒ¢ãƒ¼ãƒ‰é¸æŠå‡¦ç†
    function selectMode(mode) {
      appState.mode = mode;
      
      // é¸æŠã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      const options = document.querySelectorAll('.selection-option');
      options.forEach(opt => {
        if (opt.textContent.includes(getModeLabel(mode))) {
          opt.classList.add('selected');
        }
      });
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦é¸æŠã‚’è¡¨ç¤º
      setTimeout(() => {
        addMessage('user', `${getModeLabel(mode)}ãƒ¢ãƒ¼ãƒ‰ã§ä½œæˆã—ã¾ã™`);
        
        // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸
        updateStatusBar(2);
        
        // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸæ¬¡ã®è³ªå•
        setTimeout(() => {
          if (mode === 'slide') {
            showSlideTypeSelection();
          } else if (mode === 'report') {
            showInputMethodSelection();
          } else if (mode === 'diagram') {
            showDiagramTypeSelection();
          } else if (mode === 'draft') {
            showDraftInputSelection();
          }
        }, 500);
      }, 300);
    }
    
    // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¿ã‚¤ãƒ—é¸æŠ
    function showSlideTypeSelection() {
      addMessage('ai', 'ã‚¹ãƒ©ã‚¤ãƒ‰ã®æšæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„');
      const selectionHTML = `
        <div class="selection-container">
          <label class="selection-label">ã‚¹ãƒ©ã‚¤ãƒ‰æšæ•°</label>
          <div class="selection-options">
            <button class="selection-option" onclick="selectSlideType('single')">ğŸ“„ 1æšã‚¹ãƒ©ã‚¤ãƒ‰</button>
            <button class="selection-option" onclick="selectSlideType('multi')">ğŸ“š è¤‡æ•°æšã‚¹ãƒ©ã‚¤ãƒ‰</button>
          </div>
        </div>
      `;
      addMessage('ai', selectionHTML, true);
    }
    
    // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¿ã‚¤ãƒ—é¸æŠå‡¦ç†
    function selectSlideType(type) {
      appState.subMode = type;
      
      const options = document.querySelectorAll('.selection-option');
      options.forEach(opt => {
        if (opt.textContent.includes(type === 'single' ? '1æš' : 'è¤‡æ•°æš')) {
          opt.classList.add('selected');
        }
      });
      
      setTimeout(() => {
        addMessage('user', `${type === 'single' ? '1æš' : 'è¤‡æ•°æš'}ã‚¹ãƒ©ã‚¤ãƒ‰ã§ä½œæˆã—ã¾ã™`);
        setTimeout(() => {
          showInputMethodSelection();
        }, 500);
      }, 300);
    }
    
    // å…¥åŠ›æ–¹æ³•é¸æŠè¡¨ç¤º
    function showInputMethodSelection() {
      addMessage('ai', 'ã©ã®ã‚ˆã†ã«è³‡æ–™ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ');
      const selectionHTML = `
        <div class="selection-container">
          <label class="selection-label">ä½œæˆæ–¹æ³•ã‚’é¸æŠ</label>
          <div class="selection-options">
            <button class="selection-option" onclick="selectInputMethod('template')">ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰</button>
            <button class="selection-option" onclick="selectInputMethod('upload')">ğŸ“¤ åŸç¨¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
            <button class="selection-option" onclick="selectInputMethod('chat')">ğŸ’¬ AIã¨å¯¾è©±ã—ã¦ä½œæˆ</button>
          </div>
        </div>
      `;
      addMessage('ai', selectionHTML, true);
    }
    
    // å…¥åŠ›æ–¹æ³•é¸æŠå‡¦ç†
    function selectInputMethod(method) {
      appState.inputMethod = method;
      
      // é¸æŠã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      const options = document.querySelectorAll('.selection-option');
      options.forEach(opt => {
        if (opt.textContent.includes(getInputMethodLabel(method))) {
          opt.classList.add('selected');
        }
      });
      
      setTimeout(() => {
        addMessage('user', `${getInputMethodLabel(method)}ã§ä½œæˆã—ã¾ã™`);
        updateStatusBar(3);
        
        setTimeout(() => {
          if (method === 'template') {
            showTemplateSelection();
          } else if (method === 'upload') {
            showFileUpload();
          } else if (method === 'chat') {
            enableChat();
          }
        }, 500);
      }, 300);
    }
    
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠè¡¨ç¤º
    function showTemplateSelection() {
      addMessage('ai', 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„');
      let templateList = [];
      
      if (appState.mode === 'slide') {
        if (appState.subMode === 'single') {
          templateList = templates.slide_single;
        } else {
          templateList = templates.slide_multi;
        }
      } else if (appState.mode === 'report') {
        templateList = templates.report;
      }
      
      const optionsHTML = templateList.map(t => 
        `<button class="selection-option" onclick="selectTemplate('${t.id}')">${t.icon} ${t.name}</button>`
      ).join('');
      
      const selectionHTML = `
        <div class="selection-container">
          <label class="selection-label">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§</label>
          <div class="selection-options">${optionsHTML}</div>
        </div>
      `;
      addMessage('ai', selectionHTML, true);
    }
    
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠå‡¦ç†
    function selectTemplate(templateId) {
      appState.selectedTemplate = templateId;
      
      // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‚’å–å¾—
      let templateName = '';
      let allTemplates = [...templates.slide_single, ...templates.slide_multi, ...templates.report];
      const template = allTemplates.find(t => t.id === templateId);
      if (template) {
        templateName = template.name;
      }
      
      const options = document.querySelectorAll('.selection-option');
      options.forEach(opt => {
        if (opt.textContent.includes(templateName)) {
          opt.classList.add('selected');
        }
      });
      
      setTimeout(() => {
        addMessage('user', `ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Œ${templateName}ã€ã‚’é¸æŠã—ã¾ã—ãŸ`);
        
        // ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã®å ´åˆã®ç‰¹åˆ¥å‡¦ç†
        if (templateId === 'exec-summary') {
          setTimeout(() => {
            addMessage('ai', 'ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã®ä½œæˆæ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„');
            const selectionHTML = `
              <div class="selection-container">
                <label class="selection-label">å…¥åŠ›æ–¹æ³•</label>
                <div class="selection-options">
                  <button class="selection-option" onclick="selectTemplateInputMethod('upload')">ğŸ“¤ åŸç¨¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
                  <button class="selection-option" onclick="selectTemplateInputMethod('chat')">ğŸ’¬ AIã¨å¯¾è©±ã—ã¦ä½œæˆ</button>
                </div>
              </div>
            `;
            addMessage('ai', selectionHTML, true);
          }, 500);
        } else {
          // ãã®ä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ç›´æ¥ç”Ÿæˆã¸
          showGenerateButton();
        }
      }, 300);
    }
    
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå…¥åŠ›æ–¹æ³•é¸æŠ
    function selectTemplateInputMethod(method) {
      const options = document.querySelectorAll('.selection-option');
      options.forEach(opt => {
        if (opt.textContent.includes(method === 'upload' ? 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' : 'AIã¨å¯¾è©±')) {
          opt.classList.add('selected');
        }
      });
      
      setTimeout(() => {
        addMessage('user', `${method === 'upload' ? 'åŸç¨¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' : 'AIã¨å¯¾è©±ã—ã¦ä½œæˆ'}ã—ã¾ã™`);
        
        setTimeout(() => {
          if (method === 'upload') {
            showFileUpload();
          } else {
            enableChat();
          }
        }, 500);
      }, 300);
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¡¨ç¤º
    function showFileUpload() {
      addMessage('ai', 'åŸç¨¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„');
      const uploadHTML = `
        <div class="selection-container">
          <div class="file-upload-container">
            <input type="file" id="fileInput" class="file-upload-input" multiple onchange="handleFileUpload(event)">
            <label for="fileInput" class="file-upload-label">
              ğŸ“ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ<br>
              <small>è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå¯èƒ½</small>
            </label>
            <div class="file-list" id="fileList"></div>
          </div>
        </div>
      `;
      addMessage('ai', uploadHTML, true);
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
    function handleFileUpload(event) {
      const files = Array.from(event.target.files);
      appState.uploadedFiles = files;
      
      const fileListEl = document.getElementById('fileList');
      fileListEl.innerHTML = files.map((file, index) => `
        <div class="file-item">
          <span>ğŸ“„ ${file.name}</span>
          <span class="file-remove" onclick="removeFile(${index})">Ã—</span>
        </div>
      `).join('');
      
      if (files.length > 0) {
        setTimeout(() => {
          addMessage('user', `${files.length}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`);
          showGenerateButton();
        }, 300);
      }
    }
    
    // å›³è§£ã‚¿ã‚¤ãƒ—é¸æŠ
    function showDiagramTypeSelection() {
      addMessage('ai', 'ã©ã®ã‚ˆã†ãªå›³è§£ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ');
      const selectionHTML = `
        <div class="selection-container">
          <label class="selection-label">å›³è§£ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ</label>
          <div class="selection-options">
            <button class="selection-option" onclick="selectDiagramType('graph')">ğŸ“Š ã‚°ãƒ©ãƒ•</button>
            <button class="selection-option" onclick="selectDiagramType('gantt')">ğŸ“… ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ</button>
            <button class="selection-option" onclick="selectDiagramType('svg')">ğŸ¨ SVGå›³è§£</button>
            <button class="selection-option" onclick="selectDiagramType('mermaid')">ğŸ”„ Mermaid</button>
          </div>
        </div>
      `;
      addMessage('ai', selectionHTML, true);
    }
    
    // å›³è§£ã‚¿ã‚¤ãƒ—é¸æŠå‡¦ç†
    function selectDiagramType(type) {
      appState.diagramType = type;
      
      const options = document.querySelectorAll('.selection-option');
      options.forEach(opt => {
        if (opt.textContent.toLowerCase().includes(type)) {
          opt.classList.add('selected');
        }
      });
      
      setTimeout(() => {
        const typeLabel = {
          graph: 'ã‚°ãƒ©ãƒ•',
          gantt: 'ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ',
          svg: 'SVGå›³è§£',
          mermaid: 'Mermaid'
        }[type];
        
        addMessage('user', `${typeLabel}ã‚’ä½œæˆã—ã¾ã™`);
        updateStatusBar(3);
        
        setTimeout(() => {
          addMessage('ai', 'å›³è§£ã®ä½œæˆæ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„');
          const selectionHTML = `
            <div class="selection-container">
              <label class="selection-label">ä½œæˆæ–¹æ³•</label>
              <div class="selection-options">
                <button class="selection-option" onclick="selectDiagramInputMethod('upload')">ğŸ“¤ åŸç¨¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
                <button class="selection-option" onclick="selectDiagramInputMethod('chat')">ğŸ’¬ AIã¨å¯¾è©±ã—ã¦ä½œæˆ</button>
              </div>
            </div>
          `;
          addMessage('ai', selectionHTML, true);
        }, 500);
      }, 300);
    }
    
    // å›³è§£å…¥åŠ›æ–¹æ³•é¸æŠ
    function selectDiagramInputMethod(method) {
      const options = document.querySelectorAll('.selection-option');
      options.forEach(opt => {
        if (opt.textContent.includes(method === 'upload' ? 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' : 'AIã¨å¯¾è©±')) {
          opt.classList.add('selected');
        }
      });
      
      setTimeout(() => {
        addMessage('user', `${method === 'upload' ? 'åŸç¨¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' : 'AIã¨å¯¾è©±ã—ã¦ä½œæˆ'}ã—ã¾ã™`);
        
        setTimeout(() => {
          if (method === 'upload') {
            showFileUpload();
          } else {
            enableChat();
          }
        }, 500);
      }, 300);
    }
    
    // åŸç¨¿ä½œæˆãƒ¢ãƒ¼ãƒ‰
    function showDraftInputSelection() {
      addMessage('ai', 'åŸç¨¿ã®ä½œæˆæ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„');
      const selectionHTML = `
        <div class="selection-container">
          <label class="selection-label">ä½œæˆæ–¹æ³•</label>
          <div class="selection-options">
            <button class="selection-option" onclick="selectDraftInput('upload')">ğŸ“¤ ãŸãŸãåŸç¨¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
            <button class="selection-option" onclick="selectDraftInput('chat')">ğŸ’¬ AIã¨å¯¾è©±ã—ã¦ã‚¼ãƒ­ã‹ã‚‰ä½œæˆ</button>
          </div>
        </div>
      `;
      addMessage('ai', selectionHTML, true);
    }
    
    // åŸç¨¿å…¥åŠ›æ–¹æ³•é¸æŠ
    function selectDraftInput(method) {
      const options = document.querySelectorAll('.selection-option');
      options.forEach(opt => {
        if (opt.textContent.includes(method === 'upload' ? 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' : 'ã‚¼ãƒ­ã‹ã‚‰')) {
          opt.classList.add('selected');
        }
      });
      
      setTimeout(() => {
        addMessage('user', `${method === 'upload' ? 'ãŸãŸãåŸç¨¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' : 'AIã¨å¯¾è©±ã—ã¦ã‚¼ãƒ­ã‹ã‚‰ä½œæˆ'}ã—ã¾ã™`);
        updateStatusBar(3);
        
        setTimeout(() => {
          if (method === 'upload') {
            showFileUpload();
          } else {
            addMessage('ai', 'åŸç¨¿ã®å†…å®¹ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚ã©ã®ã‚ˆã†ãªåŸç¨¿ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ');
            enableChat();
          }
        }, 500);
      }, 300);
    }
    
    // ãƒãƒ£ãƒƒãƒˆæœ‰åŠ¹åŒ–
    function enableChat() {
      const chatInput = document.getElementById('chatInput');
      const sendBtn = document.getElementById('sendBtn');
      
      chatInput.disabled = false;
      sendBtn.disabled = false;
      
      if (appState.mode !== 'draft') {
        addMessage('ai', `${getModeLabel(appState.mode)}ã®å†…å®¹ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚ã©ã®ã‚ˆã†ãªè³‡æ–™ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ`);
      }
      
      // ä¸€å®šæ–‡å­—æ•°å…¥åŠ›å¾Œã«ç”Ÿæˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
      chatInput.addEventListener('input', () => {
        if (chatInput.value.length > 20) {
          showGenerateButton();
        }
      });
    }
    
    // é€ä¿¡ãƒœã‚¿ãƒ³ã¨ç”Ÿæˆãƒœã‚¿ãƒ³ã®åˆ¶å¾¡
    function showGenerateButton() {
      const sendBtn = document.getElementById('sendBtn');
      const generateBtn = document.getElementById('generateBtn');
      
      sendBtn.style.display = 'none';
      generateBtn.style.display = 'flex';
      generateBtn.disabled = false;
    }
    function showSendButton() {
      const sendBtn = document.getElementById('sendBtn');
      const generateBtn = document.getElementById('generateBtn');
      
      sendBtn.style.display = 'flex';
      generateBtn.style.display = 'none';
      sendBtn.disabled = false;
    }
    
    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºåˆ¶å¾¡
    function showPreview() {
      const previewContainer = document.getElementById('previewContainer');
      const previewToggle = document.getElementById('previewToggle');
      const chatPanel = document.getElementById('chatPanel');
      previewContainer.classList.remove('hidden');
      previewToggle.classList.add('hidden');
      chatPanel.classList.remove('expanded');
      appState.isPreviewVisible = true;
      updateStatusBar(4);
    }
    function hidePreview() {
      const previewContainer = document.getElementById('previewContainer');
      const previewToggle = document.getElementById('previewToggle');
      const chatPanel = document.getElementById('chatPanel');
      previewContainer.classList.add('hidden');
      previewToggle.classList.remove('hidden');
      chatPanel.classList.add('expanded');
      appState.isPreviewVisible = false;
    }

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ–åˆ‡æ›¿
    function switchPreviewTab(tab) {
      const tabs = document.querySelectorAll('.preview-tab');
      const previewFrame = document.getElementById('previewFrame');
      const codeView = document.getElementById('codeView');
      const previewPlaceholder = document.getElementById('previewPlaceholder');
      tabs.forEach(t => {
        if (t.textContent.includes(tab === 'preview' ? 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼' : 'HTML')) {
          t.classList.add('active');
        } else {
          t.classList.remove('active');
        }
      });
      if (tab === 'preview') {
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã¯æˆæœç‰©ãŒãªã‘ã‚Œã°è¡¨ç¤º
        if (!appState.versions.length) {
          previewPlaceholder.style.display = 'block';
          previewFrame.style.display = 'none';
        } else {
          previewPlaceholder.style.display = 'none';
          previewFrame.style.display = 'block';
        }
        codeView.style.display = 'none';
      } else {
        previewPlaceholder.style.display = 'none';
        previewFrame.style.display = 'none';
        codeView.style.display = 'block';
      }
      appState.currentTab = tab;
    }

    // ç”Ÿæˆå‡¦ç†
   
    document.getElementById('generateBtn').addEventListener('click', () => {
      const generateBtn = document.getElementById('generateBtn');
      generateBtn.disabled = true;
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      addMessage('ai', '<div class="loading"><div class="loading-spinner"></div></div>', true);
      setTimeout(() => {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        const messages = document.getElementById('chatMessages');
        messages.lastElementChild.remove();
        addMessage('ai', 'è³‡æ–™ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªã§ãã¾ã™ã€‚');
        showPreview();
        loadPreviewContent();
        showSendButton();
        updateStatusBar(4);
        // ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚’æœ‰åŠ¹åŒ–
        const chatInput = document.getElementById('chatInput');
        chatInput.disabled = false;
        chatInput.placeholder = 'ä¿®æ­£ã—ãŸã„å†…å®¹ã‚’å…¥åŠ›...';
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’éè¡¨ç¤ºã€æˆæœç‰©ã‚’è¡¨ç¤º
        document.getElementById('previewPlaceholder').style.display = 'none';
        document.getElementById('previewFrame').style.display = 'block';
      }, 2000);
    });
    
    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„èª­ã¿è¾¼ã¿
    function loadPreviewContent() {
      const previewFrame = document.getElementById('previewFrame');
      const codeView = document.getElementById('codeView');
      
      let sampleHTML = '';
      
      // ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã®ã‚µãƒ³ãƒ—ãƒ«
      if (appState.selectedTemplate === 'exec-summary') {
        sampleHTML = `
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body {
                font-family: 'Noto Sans JP', sans-serif;
                margin: 0;
                padding: 0;
                background: #f5f5f5;
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
              }
              .slide {
                background: white;
                width: 90%;
                max-width: 1000px;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.1);
                padding: 60px;
              }
              .header {
                border-bottom: 3px solid #00A9E0;
                padding-bottom: 20px;
                margin-bottom: 40px;
              }
              h1 {
                color: #00A9E0;
                font-size: 36px;
                margin: 0 0 10px 0;
              }
              .subtitle {
                color: #666;
                font-size: 18px;
              }
              .summary-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 30px;
                margin-top: 40px;
              }
              .summary-item {
                background: #f8f9fa;
                padding: 30px;
                border-radius: 8px;
                border-left: 4px solid #00B2A9;
              }
              .summary-item h3 {
                color: #00B2A9;
                margin: 0 0 15px 0;
                font-size: 20px;
              }
              .summary-item p {
                color: #333;
                line-height: 1.8;
                margin: 0;
              }
              .key-metrics {
                background: linear-gradient(135deg, #00A9E0, #00B2A9);
                color: white;
                padding: 30px;
                border-radius: 8px;
                margin-top: 30px;
                text-align: center;
              }
              .metric {
                display: inline-block;
                margin: 0 30px;
              }
              .metric-value {
                font-size: 36px;
                font-weight: bold;
              }
              .metric-label {
                font-size: 14px;
                opacity: 0.9;
              }
            </style>
          </head>
          <body>
            <div class="slide">
              <div class="header">
                <h1>ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼</h1>
                <div class="subtitle">2024å¹´åº¦ ç¬¬3å››åŠæœŸ ãƒ“ã‚¸ãƒã‚¹ãƒ¬ãƒãƒ¼ãƒˆ</div>
              </div>
              
              <div class="summary-grid">
                <div class="summary-item">
                  <h3>ğŸ“ˆ æ¥­ç¸¾ãƒã‚¤ãƒ©ã‚¤ãƒˆ</h3>
                  <p>å£²ä¸Šé«˜ã¯å‰å¹´åŒæœŸæ¯”15%å¢—ã®120å„„å††ã‚’é”æˆã€‚æ–°è¦äº‹æ¥­ã®ç«‹ã¡ä¸Šã’ãŒé †èª¿ã«æ¨ç§»ã—ã€æ—¢å­˜äº‹æ¥­ã‚‚å …èª¿ãªæˆé•·ã‚’ç¶­æŒã€‚</p>
                </div>
                <div class="summary-item">
                  <h3>ğŸ¯ ä¸»è¦æˆæœ</h3>
                  <p>æ–°è£½å“ã®ãƒ­ãƒ¼ãƒ³ãƒã«æˆåŠŸã—ã€å¸‚å ´ã‚·ã‚§ã‚¢ãŒ3ãƒã‚¤ãƒ³ãƒˆå‘ä¸Šã€‚é¡§å®¢æº€è¶³åº¦ã‚‚éå»æœ€é«˜ã®92%ã‚’è¨˜éŒ²ã€‚</p>
                </div>
                <div class="summary-item">
                  <h3>âš¡ ä»Šå¾Œã®æ–½ç­–</h3>
                  <p>DXæ¨é€²ã«ã‚ˆã‚‹æ¥­å‹™åŠ¹ç‡åŒ–ã‚’åŠ é€Ÿã€‚AIæŠ€è¡“ã‚’æ´»ç”¨ã—ãŸæ–°ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºã«ç€æ‰‹ã—ã€æ¥æœŸã®æˆé•·åŸºç›¤ã‚’æ§‹ç¯‰ã€‚</p>
                </div>
                <div class="summary-item">
                  <h3>ğŸ” èª²é¡Œã¨å¯¾ç­–</h3>
                  <p>åŸææ–™è²»ã®é«˜é¨°ã«å¯¾ã—ã€èª¿é”å…ˆã®å¤šæ§˜åŒ–ã¨ã‚³ã‚¹ãƒˆæ§‹é€ ã®è¦‹ç›´ã—ã‚’å®Ÿæ–½ã€‚ç”Ÿç”£æ€§å‘ä¸Šã«ã‚ˆã‚Šå½±éŸ¿ã‚’æœ€å°åŒ–ã€‚</p>
                </div>
              </div>
              
              <div class="key-metrics">
                <div class="metric">
                  <div class="metric-value">120å„„å††</div>
                  <div class="metric-label">å£²ä¸Šé«˜</div>
                </div>
                <div class="metric">
                  <div class="metric-value">+15%</div>
                  <div class="metric-label">æˆé•·ç‡</div>
                </div>
                <div class="metric">
                  <div class="metric-value">92%</div>
                  <div class="metric-label">é¡§å®¢æº€è¶³åº¦</div>
                </div>
              </div>
            </div>
          </body>
          </html>
        `;
      } 
      // SVGå›³è§£ã®ã‚µãƒ³ãƒ—ãƒ«
      else if (appState.diagramType === 'svg') {
        sampleHTML = `
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body {
                font-family: 'Noto Sans JP', sans-serif;
                margin: 0;
                padding: 40px;
                background: #f5f5f5;
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
              }
              .diagram-container {
                background: white;
                padding: 40px;
                border-radius: 12px;
                box-shadow: 0 4px 16px rgba(0,0,0,0.1);
                text-align: center;
              }
              h2 {
                color: #00A9E0;
                margin-bottom: 30px;
              }
              svg {
                max-width: 100%;
                height: auto;
              }
            </style>
          </head>
          <body>
            <div class="diagram-container">
              <h2>æ¥­å‹™ãƒ•ãƒ­ãƒ¼å›³</h2>
              <svg width="800" height="400" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                <!-- èƒŒæ™¯ -->
                <rect width="800" height="400" fill="#f8f9fa" rx="8"/>
                
                <!-- ãƒ—ãƒ­ã‚»ã‚¹1 -->
                <rect x="50" y="150" width="120" height="80" rx="8" fill="#00A9E0" stroke="#0089C0" stroke-width="2"/>
                <text x="110" y="195" text-anchor="middle" fill="white" font-size="16" font-weight="bold">é–‹å§‹</text>
                
                <!-- çŸ¢å°1 -->
                <path d="M 170 190 L 230 190" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- ãƒ—ãƒ­ã‚»ã‚¹2 -->
                <rect x="230" y="150" width="140" height="80" rx="8" fill="#00B2A9" stroke="#009089" stroke-width="2"/>
                <text x="300" y="185" text-anchor="middle" fill="white" font-size="16" font-weight="bold">ãƒ‡ãƒ¼ã‚¿åé›†</text>
                <text x="300" y="205" text-anchor="middle" fill="white" font-size="14">è‡ªå‹•å‡¦ç†</text>
                
                <!-- çŸ¢å°2 -->
                <path d="M 370 190 L 430 190" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- åˆ¤æ–­ -->
                <path d="M 500 150 L 570 190 L 500 230 L 430 190 Z" fill="#DA1884" stroke="#BA0664" stroke-width="2"/>
                <text x="500" y="195" text-anchor="middle" fill="white" font-size="16" font-weight="bold">åˆ¤å®š</text>
                
                <!-- çŸ¢å°3ï¼ˆYESï¼‰ -->
                <path d="M 570 190 L 630 190" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="600" y="180" text-anchor="middle" font-size="14" fill="#333">YES</text>
                
                <!-- çŸ¢å°4ï¼ˆNOï¼‰ -->
                <path d="M 500 230 L 500 300 L 300 300 L 300 230" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="500" y="270" text-anchor="middle" font-size="14" fill="#333">NO</text>
                
                <!-- ãƒ—ãƒ­ã‚»ã‚¹3 -->
                <rect x="630" y="150" width="120" height="80" rx="8" fill="#52C41A" stroke="#3FA00A" stroke-width="2"/>
                <text x="690" y="195" text-anchor="middle" fill="white" font-size="16" font-weight="bold">å®Œäº†</text>
                
                <!-- çŸ¢å°ã®å…ˆç«¯å®šç¾© -->
                <defs>
                  <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
                  </marker>
                </defs>
                
                <!-- å‡¡ä¾‹ -->
                <g transform="translate(50, 50)">
                  <rect x="0" y="0" width="150" height="80" rx="4" fill="white" stroke="#ddd" stroke-width="1"/>
                  <text x="10" y="20" font-size="14" font-weight="bold" fill="#333">å‡¡ä¾‹</text>
                  <rect x="10" y="30" width="20" height="15" rx="2" fill="#00A9E0"/>
                  <text x="35" y="42" font-size="12" fill="#666">ãƒ—ãƒ­ã‚»ã‚¹</text>
                  <rect x="10" y="50" width="20" height="15" rx="2" fill="#DA1884"/>
                  <text x="35" y="62" font-size="12" fill="#666">åˆ¤æ–­</text>
                </g>
              </svg>
            </div>
          </body>
          </html>
        `;
      }
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«
      else {
        sampleHTML = `
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body {
                font-family: 'Noto Sans JP', sans-serif;
                margin: 0;
                padding: 40px;
                background: #f5f5f5;
              }
              .slide {
                background: white;
                border-radius: 8px;
                padding: 40px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                max-width: 800px;
                margin: 0 auto;
              }
              h1 {
                color: #00A9E0;
                margin-bottom: 24px;
              }
              .content {
                line-height: 1.8;
                color: #333;
              }
            </style>
          </head>
          <body>
            <div class="slide">
              <h1>è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚¹ãƒ©ã‚¤ãƒ‰</h1>
              <div class="content">
                <p>ã“ã‚Œã¯è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚</p>
                <p>AIãŒå…¥åŠ›å†…å®¹ã«åŸºã¥ã„ã¦æœ€é©ãªè³‡æ–™ã‚’ä½œæˆã—ã¾ã—ãŸã€‚</p>
              </div>
            </div>
          </body>
          </html>
        `;
      }
      
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤º
      previewFrame.srcdoc = sampleHTML;
      codeView.textContent = sampleHTML;
      
      // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
      appState.versions.push({
        id: `v${appState.versions.length + 1}`,
        content: sampleHTML,
        timestamp: new Date()
      });
      
      updateVersionSelector();
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’éè¡¨ç¤º
      document.getElementById('previewPlaceholder').style.display = 'none';
      previewFrame.style.display = 'block';
    }
    
    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼æ›´æ–°
    function updateVersionSelector() {
      const versionSelect = document.getElementById('versionSelect');
      versionSelect.innerHTML = appState.versions.map((v, index) => 
        `<option value="${v.id}">${v.id} ${index === appState.versions.length - 1 ? '(æœ€æ–°)' : ''}</option>`
      ).join('');
    }
    
    // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    function getModeLabel(mode) {
      const labels = {
        slide: 'ã‚¹ãƒ©ã‚¤ãƒ‰',
        report: 'ãƒ¬ãƒãƒ¼ãƒˆ',
        diagram: 'å›³è§£ç”Ÿæˆ',
        draft: 'åŸç¨¿ä½œæˆ'
      };
      return labels[mode] || mode;
    }
    
    function getInputMethodLabel(method) {
      const labels = {
        template: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰',
        upload: 'åŸç¨¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
        chat: 'AIã¨å¯¾è©±ã—ã¦ä½œæˆ'
      };
      return labels[method] || method;
    }
    
    // ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã®è‡ªå‹•ãƒªã‚µã‚¤ã‚º
    const chatInput = document.getElementById('chatInput');
    chatInput.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
    });
    
    // é€ä¿¡å‡¦ç†
    document.getElementById('sendBtn').addEventListener('click', () => {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (message) {
        addMessage('user', message);
        input.value = '';
        input.style.height = 'auto';
        
        // AIå¿œç­”ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
        setTimeout(() => {
          addMessage('ai', 'ã”è¦æœ›ã‚’æ‰¿ã‚Šã¾ã—ãŸã€‚è³‡æ–™ã«åæ˜ ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚');
          
          // ç”Ÿæˆãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„å ´åˆã¯è¡¨ç¤º
          if (document.getElementById('generateBtn').style.display === 'none' && 
              document.getElementById('generateBtn').disabled) {
            showGenerateButton();
          }
        }, 1000);
      }
    });
    
    // Enterã‚­ãƒ¼ã§é€ä¿¡
    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        document.getElementById('sendBtn').click();
      }
    });
    
    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¾Œã«ãƒ¢ãƒ¼ãƒ‰é¸æŠã‚’è¡¨ç¤º
      setTimeout(() => {
        showModeSelection();
      }, 500);
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼åˆæœŸè¡¨ç¤º
      document.getElementById('previewPlaceholder').style.display = 'block';
      document.getElementById('previewFrame').style.display = 'none';
      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã¯æœ€åˆã‹ã‚‰è¡¨ç¤º
      document.getElementById('previewToggle').classList.remove('hidden');
    });
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ã‚’è¿½åŠ 
    (function() {
      const chatPanel = document.getElementById('chatPanel');
      const previewContainer = document.getElementById('previewContainer');
      const resizeBar = document.getElementById('resizeBar');
      const mainArea = document.getElementById('mainArea');
      let isDragging = false;
      let startX = 0;
      let startRatio = 0;

      function updateResizeBarVisibility() {
        if (!previewContainer.classList.contains('hidden')) {
          resizeBar.classList.add('visible');
        } else {
          resizeBar.classList.remove('visible');
        }
      }

      function setPanelRatios(chatRatio) {
        // chatRatio: 0.0ï½1.0
        chatRatio = Math.max(0.2, Math.min(chatRatio, 0.8));
        const previewRatio = 1 - chatRatio;
        chatPanel.style.flexBasis = (chatRatio * 100) + '%';
        previewContainer.style.flexBasis = (previewRatio * 100) + '%';
        chatPanel.style.flexGrow = '1';
        previewContainer.style.flexGrow = '1';
        chatPanel.style.flexShrink = '1';
        previewContainer.style.flexShrink = '1';
      }

      function onResizeBarMouseDown(e) {
        if (previewContainer.classList.contains('hidden')) return;
        isDragging = true;
        resizeBar.classList.add('dragging');
        startX = e.clientX;
        // ç¾åœ¨ã®æ¯”ç‡ã‚’è¨ˆç®—
        const mainAreaRect = mainArea.getBoundingClientRect();
        const chatWidth = chatPanel.getBoundingClientRect().width;
        startRatio = chatWidth / mainAreaRect.width;
        document.body.style.cursor = 'ew-resize';
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      }

      function onMouseMove(e) {
        if (!isDragging) return;
        const mainAreaRect = mainArea.getBoundingClientRect();
        let delta = e.clientX - startX;
        let chatWidth = mainAreaRect.width * startRatio + delta;
        let chatRatio = chatWidth / mainAreaRect.width;
        setPanelRatios(chatRatio);
      }

      function onMouseUp() {
        isDragging = false;
        resizeBar.classList.remove('dragging');
        document.body.style.cursor = '';
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      }

      resizeBar.addEventListener('mousedown', onResizeBarMouseDown);

      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º/éè¡¨ç¤ºæ™‚ã«ãƒªã‚µã‚¤ã‚ºãƒãƒ¼ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
      const origShowPreview = window.showPreview;
      window.showPreview = function() {
        origShowPreview();
        updateResizeBarVisibility();
        // ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«ã‚’æœ€å°å¹…ã€æ®‹ã‚Šã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«
        const mainAreaRect = mainArea.getBoundingClientRect();
        const minChat = 240;
        let chatRatio = minChat / mainAreaRect.width;
        chatRatio = Math.max(0.2, Math.min(chatRatio, 0.8));
        setPanelRatios(chatRatio);
      };
      const origHidePreview = window.hidePreview;
      window.hidePreview = function() {
        origHidePreview();
        updateResizeBarVisibility();
        chatPanel.style.flexBasis = '100%';
        previewContainer.style.flexBasis = '100%';
      };

      document.addEventListener('DOMContentLoaded', updateResizeBarVisibility);
      window.addEventListener('resize', function() {
        if (!previewContainer.classList.contains('hidden')) {
          const mainAreaRect = mainArea.getBoundingClientRect();
          const chatWidth = chatPanel.getBoundingClientRect().width;
          let chatRatio = chatWidth / mainAreaRect.width;
          setPanelRatios(chatRatio);
        }
      });
    })();
  </script>
</body>
</html>